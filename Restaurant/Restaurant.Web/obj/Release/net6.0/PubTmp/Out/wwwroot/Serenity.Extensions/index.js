var Serenity=Serenity||{};Serenity._=(()=>{var $e=Object.create;var K=Object.defineProperty;var Ae=Object.getOwnPropertyDescriptor;var Me=Object.getOwnPropertyNames;var Ue=Object.getPrototypeOf,_e=Object.prototype.hasOwnProperty;var o=(n,t)=>K(n,"name",{value:t,configurable:!0});var We=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports),ze=(n,t)=>{for(var e in t)K(n,e,{get:t[e],enumerable:!0})},Ve=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of Me(t))!_e.call(n,i)&&i!==e&&K(n,i,{get:()=>t[i],enumerable:!(r=Ae(t,i))||r.enumerable});return n};var u=(n,t,e)=>(e=n!=null?$e(Ue(n)):{},Ve(t||!n||!n.__esModule?K(e,"default",{value:n,enumerable:!0}):e,n)),Qe=n=>Ve(K({},"__esModule",{value:!0}),n),m=(n,t,e,r)=>{for(var i=r>1?void 0:r?Ae(t,e):t,a=n.length-1,c;a>=0;a--)(c=n[a])&&(i=(r?c(t,e,i):c(i))||i);return r&&i&&K(t,e,i),i};var Ie=(n,t,e)=>new Promise((r,i)=>{var a=p=>{try{s(e.next(p))}catch(f){i(f)}},c=p=>{try{s(e.throw(p))}catch(f){i(f)}},s=p=>p.done?r(p.value):Promise.resolve(p.value).then(a,c);s((e=e.apply(n,t)).next())});var l=We((Ye,Ne)=>{Ne.exports=Serenity});var Je={};ze(Je,{BasicProgressDialog:()=>D,BulkServiceAction:()=>he,ChangePasswordForm:()=>oe,DialogUtils:()=>Fe,EnumSelectFormatter:()=>S,ExcelExportHelper:()=>Oe,ForgotPasswordForm:()=>ne,GridEditorBase:()=>Q,GridEditorDialog:()=>J,PdfExportHelper:()=>ke,PromptDialog:()=>I,ReportDialog:()=>w,ReportHelper:()=>ce,ReportPage:()=>Y,ResetPasswordForm:()=>ue,SelectableEntityGrid:()=>ee,ServiceEditorBase:()=>te,SingleLineTextFormatter:()=>E,StaticTextBlock:()=>re,UserPreferenceRow:()=>v,UserPreferenceService:()=>W,UserPreferenceStorage:()=>xe});var M=u(l(),1);var ae=class extends M.PrefixedContext{constructor(t){if(super(t),!ae.init){ae.init=!0;var e=M.PasswordEditor;(0,M.initFormType)(ae,["OldPassword",e,"NewPassword",e,"ConfirmPassword",e])}}},oe=ae;o(oe,"ChangePasswordForm"),oe.formKey="Serenity.Extensions.ChangePasswordRequest";var U=u(l(),1);var le=class extends U.PrefixedContext{constructor(t){if(super(t),!le.init){le.init=!0;var e=U.EmailAddressEditor;(0,U.initFormType)(le,["Email",e])}}},ne=le;o(ne,"ForgotPasswordForm"),ne.formKey="Serenity.Extensions.ForgotPasswordRequest";var _=u(l(),1);var pe=class extends _.PrefixedContext{constructor(t){if(super(t),!pe.init){pe.init=!0;var e=_.PasswordEditor;(0,_.initFormType)(pe,["NewPassword",e,"ConfirmPassword",e])}}},ue=pe;o(ue,"ResetPasswordForm"),ue.formKey="Serenity.Extensions.ResetPasswordRequest";var He=u(l(),1);var v=class{};o(v,"UserPreferenceRow"),v.idProperty="UserPreferenceId",v.nameProperty="Name",v.localTextPrefix="Common.UserPreference",v.deletePermission="",v.insertPermission="",v.readPermission="",v.updatePermission="",v.Fields=(0,He.fieldsProxy)();var je=u(l(),1),W;(e=>(e.baseUrl="Extensions/UserPreference",e.Methods={Update:"Extensions/UserPreference/Update",Retrieve:"Extensions/UserPreference/Retrieve"},["Update","Retrieve"].forEach(r=>{e[r]=function(i,a,c){return(0,je.serviceRequest)(e.baseUrl+"/"+r,i,a,c)}})))(W||(W={}));var me=u(l(),1),z=u(l(),1);var D=class extends me.TemplatedDialog{constructor(){super();this.dialogTitle=(0,z.localText)("Site.BasicProgressDialog.PleaseWait")}get max(){return parseInt(this.byId("ProgressBar").attr("aria-valuemax"),10)}set max(e){this.byId("ProgressBar").attr("aria-valuemax",(e||100).toString())}get value(){return parseInt(this.byId("ProgressBar").attr("aria-valuenow"),10)}set value(e){this.byId("ProgressBar").attr("aria-valuenow",(e||0).toString()).css("width",(e||0)/(this.max||100)*100+"%").text(e+" / "+this.max)}get title(){return this.dialogTitle}set title(e){this.dialogTitle=e}getDialogButtons(){return[{text:(0,z.localText)("Dialogs.CancelButton"),class:"btn btn-danger",click:()=>{this.cancelled=!0,this.element.closest(".ui-dialog").find(".ui-dialog-buttonpane .ui-button").attr("disabled","disabled").css("opacity","0.5"),this.element.dialog("option","title",(0,z.trimToNull)(this.cancelTitle)||(0,z.localText)("Site.BasicProgressDialog.CancelTitle"))}}]}getDialogOptions(){var e=super.getDialogOptions();return e.width=600,e}initDialog(){super.initDialog(),this.element.closest(".ui-dialog").find(".ui-dialog-titlebar-close").hide()}getTemplate(){return`<div class="s-DialogContent s-BasicProgressDialogContent">
    <div id="~_StatusText" class="status-text" ></div>
        <div id="~_Progress" class="progress" style="height: 1.5rem">
        <div id="~_ProgressBar" class="progress-bar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
</div>`}};o(D,"BasicProgressDialog"),D=m([me.Decorators.registerClass("Serenity.Extensions.BasicProgressDialog")],D);var h=u(l(),1);var he=class{createProgressDialog(){this.progressDialog=new D,this.progressDialog.dialogOpen(),this.progressDialog.max=this.keys.length,this.progressDialog.value=0}getConfirmationFormat(){return(0,h.localText)("Site.BulkServiceAction.ConfirmationFormat")}getConfirmationMessage(t){return(0,h.format)(this.getConfirmationFormat(),t)}confirm(t,e){(0,h.confirmDialog)(this.getConfirmationMessage(t),e)}getNothingToProcessMessage(){return(0,h.localText)("Site.BulkServiceAction.NothingToProcess")}nothingToProcess(){(0,h.notifyError)(this.getNothingToProcessMessage())}getParallelRequests(){return 1}getBatchSize(){return 1}startParallelExecution(){this.createProgressDialog(),this.successCount=0,this.errorCount=0,this.pendingRequests=0,this.completedRequests=0,this.errorCount=0,this.errorByKey={},this.queue=this.keys.slice(),this.queueIndex=0;for(var t=this.getParallelRequests();t-- >0;)this.executeNextBatch()}serviceCallCleanup(){this.pendingRequests--,this.completedRequests++;var t=(0,h.localText)(this.progressDialog.cancelled?"Site.BasicProgressDialog.CancelTitle":"Site.BasicProgressDialog.PleaseWait");t+=" (",this.successCount>0&&(t+=(0,h.format)((0,h.localText)("Site.BulkServiceAction.SuccessCount"),this.successCount)),this.errorCount>0&&(this.successCount>0&&(t+=", "),t+=(0,h.format)((0,h.localText)("Site.BulkServiceAction.ErrorCount"),this.errorCount)),this.progressDialog.title=t+")",this.progressDialog.value=this.successCount+this.errorCount,!this.progressDialog.cancelled&&this.progressDialog.value<this.keys.length?this.executeNextBatch():this.pendingRequests===0&&(this.progressDialog.dialogClose(),this.showResults(),this.done&&(this.done(),this.done=null))}executeForBatch(t){}executeNextBatch(){for(var t=this.getBatchSize(),e=[];!(e.length>=t||this.queueIndex>=this.queue.length);)e.push(this.queue[this.queueIndex++]);e.length>0&&(this.pendingRequests++,this.executeForBatch(e))}getAllHadErrorsFormat(){return(0,h.localText)("Site.BulkServiceAction.AllHadErrorsFormat")}showAllHadErrors(){(0,h.notifyError)((0,h.format)(this.getAllHadErrorsFormat(),this.errorCount))}getSomeHadErrorsFormat(){return(0,h.localText)("Site.BulkServiceAction.SomeHadErrorsFormat")}showSomeHadErrors(){(0,h.notifyWarning)((0,h.format)(this.getSomeHadErrorsFormat(),this.successCount,this.errorCount))}getAllSuccessFormat(){return(0,h.localText)("Site.BulkServiceAction.AllSuccessFormat")}showAllSuccess(){(0,h.notifySuccess)((0,h.format)(this.getAllSuccessFormat(),this.successCount))}showResults(){if(this.errorCount===0&&this.successCount===0){this.nothingToProcess();return}if(this.errorCount>0&&this.successCount===0){this.showAllHadErrors();return}if(this.errorCount>0){this.showSomeHadErrors();return}this.showAllSuccess()}execute(t){if(this.keys=t,this.keys.length===0){this.nothingToProcess();return}this.confirm(this.keys.length,()=>this.startParallelExecution())}get_successCount(){return this.successCount}set_successCount(t){this.successCount=t}get_errorCount(){return this.errorCount}set_errorCount(t){this.errorCount=t}};o(he,"BulkServiceAction");var B=u(l(),1);var Oe;(t=>{function n(e){return{hint:(0,B.coalesce)(e.hint,"Excel"),title:(0,B.coalesce)(e.title,""),cssClass:"export-xlsx-button",icon:"fa-file-excel-o",onClick:function(){if(!e.onViewSubmit())return;let r=e.grid;var i=(0,B.deepClone)(r.getView().params);i.Take=0,i.Skip=0;var a=r.getView().sortBy;a&&(i.Sort=a),i.ExportColumns=[];let c=r.getGrid().getColumns();for(let s of c)i.ExportColumns.push(s.id||s.field);e.editRequest&&(i=e.editRequest(i)),(0,B.postToService)({service:e.service,request:i,target:"_blank"})},separator:e.separator}}t.createToolButton=n,o(n,"createToolButton")})(Oe||(Oe={}));var x=u(l(),1);var ke;(c=>{function n(s,p,f){return s.map(y=>{let g={dataKey:y.id||y.field,title:y.name||""};f&&f[g.dataKey]!=null&&(g.title=f[g.dataKey]);let b={};return(y.cssClass||"").indexOf("align-right")>=0?b.halign="right":(y.cssClass||"").indexOf("align-center")>=0&&(b.halign="center"),p[g.dataKey]=b,g})}o(n,"toAutoTableColumns");function t(s,p,f,y){let g=document.createElement("span"),b=0;return p.map(H=>{let d=[];for(let L=0;L<y.length;L++){var ie=y[L],se=s.getFormatter(b,ie),j=s.getFormatterContext(b,L);j.item=H,j.value=H[ie.field];let F=se?se(j):"";!F||F.indexOf("<")<0&&F.indexOf("&")<0?d.push(F):(g.innerHTML=F,g.children.length==1&&$(g.children[0]).is("select")?d.push($(g.children[0]).children("[selected]").text()):g.children.length==1&&$(g.children[0]).is(":input")?d.push($(g.children[0]).val()):g.children.length==1&&$(g.children).is(".check-box")?d.push($(g.children).hasClass("checked")?"X":""):d.push(g.textContent||""))}return b++,d})}o(t,"toAutoTableData");function e(s){var p=s.grid;if(s.onViewSubmit()){a();var f=(0,x.deepClone)(p.view.params);f.Take=0,f.Skip=0;var y=p.view.sortBy;y!=null&&(f.Sort=y);var g=p.slickGrid.getColumns();g=g.filter(H=>H.id!=="__select__"),f.IncludeColumns=[];for(var b of g)f.IncludeColumns.push(b.id||b.field);(0,x.serviceCall)({url:p.view.url,request:f,onSuccess:H=>{let d=new jsPDF("l","pt"),ie=g,se={},j=n(ie,se,s.columnTitles);var L=j.map(q=>q.dataKey);let F=H.Entities||[],Ge=t(p.slickGrid,F,L,ie);d.setFontSize(s.titleFontSize||10),d.setFont("helvetica","bold");let Ke=s.reportTitle||p.getTitle()||"Report";d.autoTableText(Ke,d.internal.pageSize.width/2,s.titleTop||25,{halign:"center"});var qe="{{T}}";let Be=s.pageNumbers==null||s.pageNumbers;var G=$.extend({margin:{top:25,left:25,right:25,bottom:Be?25:30},startY:60,styles:{fontSize:8,overflow:"linebreak",cellPadding:2,valign:"middle"},columnStyles:se},s.tableOptions),Pe,De;if(Be&&(Pe=o(function(q){var we=q.pageCount;typeof d.putTotalPages=="function"&&(we=we+" / "+qe),d.autoTableText(we,d.internal.pageSize.width/2,d.internal.pageSize.height-G.margin.bottom,{halign:"center"})},"footer")),(s.printDateTimeHeader==null||s.printDateTimeHeader)&&(De=o(function(q){d.setFont("helvetica","normal"),d.setFontSize(8),d.autoTableText((0,x.formatDate)(new Date,"dd-MM-yyyy HH:mm"),d.internal.pageSize.width-G.margin.right,13,{halign:"right"})},"header")),G.didDrawPage=q=>{De&&De(q),Pe&&Pe(q)},G.head=[j],G.body=Ge,d.autoTable(G),typeof d.putTotalPages=="function"&&d.putTotalPages(qe),!s.output||s.output=="file"){var Re=s.fileName||s.reportTitle||"{0}_{1}.pdf";Re=(0,x.format)(Re,p.getTitle()||"report",(0,x.formatDate)(new Date,"yyyyMMdd_HHmm")),d.save(Re);return}s.autoPrint&&d.autoPrint();var Ee=s.output;Ee=="newwindow",Ee="dataurlnewwindow",d.output(Ee)}})}}c.exportToPdf=e,o(e,"exportToPdf");function r(s){return{title:s.title||"",hint:s.hint||"PDF",cssClass:"export-pdf-button",onClick:()=>e(s),separator:s.separator}}c.createToolButton=r,o(r,"createToolButton");function i(){if(typeof jsPDF=="undefined"){var s=$("jsPDFScript");s.length>0||($("<script/>").attr("type","text/javascript").attr("id","jsPDFScript").attr("src",(0,x.resolveUrl)("~/Serenity.Assets/Scripts/jspdf.min.js")).appendTo(document.head),typeof jsPDF=="undefined"&&typeof jspdf!="undefined"&&(window.jsPDF=jspdf.jsPDF))}}o(i,"includeJsPDF");function a(){if(i(),!(typeof jsPDF=="undefined"||typeof jsPDF.API=="undefined"||typeof jsPDF.API.autoTable!="undefined")){var s=$("jsPDFAutoTableScript");s.length>0||$("<script/>").attr("type","text/javascript").attr("id","jsPDFAutoTableScript").attr("src",(0,x.resolveUrl)("~/Serenity.Assets/Scripts/jspdf.plugin.autotable.min.js")).appendTo(document.head)}}o(a,"includeAutoTable")})(ke||(ke={}));var A=u(l(),1),R=u(l(),1);var S=class{constructor(){this.allowClear=!0}format(t){var e=A.EnumTypeRegistry.get(this.enumKey),r="<select>";this.allowClear&&(r+='<option value="">',r+=(0,R.htmlEncode)(this.emptyItemText||(0,R.localText)("Controls.SelectEditor.EmptyItemText")),r+="</option>");for(var i of Object.keys(e).filter(c=>!isNaN(parseInt(c,10)))){r+='<option value="'+(0,R.htmlEncode)(i)+'"',i==t.value&&(r+=" selected");var a=e[i];r+=">",r+=(0,R.htmlEncode)((0,R.tryGetText)("Enums."+this.enumKey+"."+a)||a),r+="</option>"}return r+="</select>",r}};o(S,"EnumSelectFormatter"),m([A.Decorators.option()],S.prototype,"enumKey",2),m([A.Decorators.option()],S.prototype,"allowClear",2),m([A.Decorators.option()],S.prototype,"emptyItemText",2),S=m([A.Decorators.registerFormatter("Serenity.Extensions.EnumSelectFormatter")],S);var Le=u(l(),1),ge=u(l(),1);var E=class{format(t){return E.formatValue(t.value)}static formatValue(t){var e=$("<div/>").html(t||"").text();return(0,ge.htmlEncode)((0,ge.toSingleLine)(e))}};o(E,"SingleLineTextFormatter"),E=m([Le.Decorators.registerFormatter("Serenity.Extensions.SingleLineTextFormatter")],E);var C=u(l(),1),P=u(l(),1);var Q=class extends C.EntityGrid{constructor(e,r){super(e,r);this.nextId=1}getIdProperty(){return"__id"}id(e){return e[this.getIdProperty()]}getNextId(){return"`"+this.nextId++}setNewId(e){e[this.getIdProperty()]=this.getNextId()}save(e,r){var i=e.request,a=(0,P.deepClone)(i.Entity),c=this.id(a);if(c==null&&(a[this.getIdProperty()]=this.getNextId()),!!this.validateEntity(a,c)){var s=this.view.getItems().slice();if(c==null)s.push(a);else{var p=(0,P.indexOf)(s,f=>this.id(f)===c);s[p]=(0,P.deepClone)({},s[p],a)}this.setEntities(s),r({})}}deleteEntity(e){return this.view.deleteItem(e),!0}validateEntity(e,r){return!0}setEntities(e){this.view.setItems(e,!0)}getNewEntity(){return{}}getButtons(){var e=super.getButtons(),r=(0,P.tryFirst)(e,i=>i.action==="add");return r!=null&&(r.onClick=()=>{this.createEntityDialog(this.getItemType(),i=>{var a=i;a.onSave=(c,s)=>this.save(c,s),this.transferDialogReadOnly(a),a.loadEntityAndOpenDialog(this.getNewEntity())})}),e.filter(i=>i.action!=="refresh")}editItem(e){var r=e,i=this.view.getItemById(r);this.createEntityDialog(this.getItemType(),a=>{var c=a;c.onDelete=(s,p)=>{this.deleteEntity(r)&&p({})},this.transferDialogReadOnly(c),c.onSave=(s,p)=>this.save(s,p),c.loadEntityAndOpenDialog(i)})}getEditValue(e,r){r[e.name]=this.value}setEditValue(e,r){this.value=e[r.name]}get value(){var e=this.getIdProperty();return this.view.getItems().map(r=>{var i=(0,P.deepClone)(r),a=i[e];return a&&a.toString().charAt(0)=="`"&&delete i[e],i})}set value(e){var r=this.getIdProperty();this.view.setItems((e||[]).map(i=>{var a=(0,P.deepClone)(i);return a[r]==null&&(a[r]=this.getNextId()),a}),!0)}getGridCanLoad(){return!1}usePager(){return!1}getInitialTitle(){return null}createQuickSearchInput(){}};o(Q,"GridEditorBase"),Q=m([C.Decorators.registerClass("Serenity.Extensions.GridEditorBase",[C.IGetEditValue,C.ISetEditValue]),C.Decorators.editor(),C.Decorators.element("<div/>")],Q);var fe=u(l(),1);var J=class extends fe.EntityDialog{getIdProperty(){return"__id"}destroy(){this.onSave=null,this.onDelete=null,super.destroy()}updateInterface(){super.updateInterface(),this.applyChangesButton&&this.applyChangesButton.hide()}saveHandler(e,r){this.onSave&&this.onSave(e,r)}deleteHandler(e,r){this.onDelete&&this.onDelete(e,r)}};o(J,"GridEditorDialog"),J=m([fe.Decorators.registerClass("Serenity.Extensions.GridEditorDialog")],J);var X=u(l(),1),ye=u(l(),1);var V=u(l(),1);var ce;(e=>{function n(r){return{title:(0,V.coalesce)(r.title,"Report"),cssClass:(0,V.coalesce)(r.cssClass,"print-button"),icon:r.icon,onClick:()=>{e.execute(r)}}}e.createToolButton=n,o(n,"createToolButton");function t(r){var i=r.getParams?r.getParams():r.params;(0,V.postToUrl)({url:"~/Serenity.Extensions/Report/"+(r.download?"Download":"Render"),params:{key:r.reportKey,ext:(0,V.coalesce)(r.extension,"pdf"),opt:i?$.toJSON(i):""},target:(0,V.coalesce)(r.target,"_blank")})}e.execute=t,o(t,"execute")})(ce||(ce={}));var w=class extends X.TemplatedDialog{constructor(e){super(e);this.updateInterface(),this.loadReport(this.options.reportKey)}getDialogButtons(){return null}createPropertyGrid(){this.propertyGrid&&this.byId("PropertyGrid").html("").attr("class",""),this.propertyGrid=new X.PropertyGrid(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:!0,items:this.report.Properties}).init(null)}loadReport(e){(0,ye.serviceCall)({url:(0,ye.resolveUrl)("~/Serenity.Extensions/Report/Retrieve"),request:{ReportKey:e},onSuccess:r=>{this.report=r,this.dialogTitle=this.report.Title,this.createPropertyGrid(),this.propertyGrid.load(this.report.InitialSettings||{}),this.updateInterface(),this.dialogOpen()}})}updateInterface(){this.toolbar.findButton("print-preview-button").toggle(this.report&&!this.report.IsDataOnlyReport&&!this.report.IsExternalReport),this.toolbar.findButton("run-button").toggle(this.report&&this.report.IsExternalReport),this.toolbar.findButton("export-pdf-button").toggle(this.report&&!this.report.IsDataOnlyReport&&!this.report.IsExternalReport),this.toolbar.findButton("export-xlsx-button").toggle(this.report&&this.report.IsDataOnlyReport&&!this.report.IsExternalReport)}executeReport(e,r,i){if(this.validateForm()){var a={};this.propertyGrid.save(a),ce.execute({download:i,reportKey:this.report.ReportKey,extension:r,target:e,params:a})}}getToolbarButtons(){return[{title:"Preview",cssClass:"print-preview-button",onClick:()=>this.executeReport("_blank",null,!1)},{title:"Run",cssClass:"run-button",icon:"fa-print text-blue",onClick:()=>this.executeReport("_blank",null,!1)},{title:"PDF",cssClass:"export-pdf-button",onClick:()=>this.executeReport("_blank","pdf",!0)},{title:"Excel",cssClass:"export-xlsx-button",onClick:()=>this.executeReport("_blank","xlsx",!0)}]}getTemplate(){return`<div class="s-DialogContent">
<div id="~_Toolbar" class="s-DialogToolbar">
</div>
<div class="s-Form">
    <form id="~_Form" action="">
        <div class="fieldset ui-widget ui-widget-content ui-corner-all">
            <div id="~_PropertyGrid"></div>
            <div class="clear"></div>
        </div>
    </form>
</div>
</div>`}};o(w,"ReportDialog"),w=m([X.Decorators.registerClass("Serenity.Extensions.ReportDialog")],w);var Z=u(l(),1),ve=u(l(),1);var Y=class extends Z.Widget{constructor(t){super(t),$(".report-link",t).click(e=>this.reportLinkClick(e)),new Z.QuickSearchInput($(".s-QuickSearchBar input",t),{onSearch:(e,r,i)=>{this.updateMatchFlags(r),i(!0)}})}updateMatchFlags(t){var e=$(".report-list",this.element).find("li").removeClass("non-match");if(t=(0,ve.trimToNull)(t),!!t){t=Select2.util.stripDiacritics(t).toUpperCase();var r=e.filter(".report-item");r.each(function(s,p){var f=$(p),y=Select2.util.stripDiacritics((0,ve.coalesce)(f.text(),"").toUpperCase());y.indexOf(t)<0&&f.addClass("non-match")});var i=r.not(".non-match"),a=i.parents("li").add(i);a.children("[data-bs-toggle]:not([aria-expanded=true])").attr("aria-expanded","true").removeClass("collapsed"),a.parent(".collapse:not(.show)").addClass("show");var c=e.not(a);c.addClass("non-match")}}reportLinkClick(t){t.preventDefault(),new w({reportKey:$(t.target).data("key")}).dialogOpen()}};o(Y,"ReportPage"),Y=m([Z.Decorators.registerClass("Serenity.Extensions.ReportPage")],Y);var xe=class{getItem(t){return Ie(this,null,function*(){return(yield Promise.resolve(W.Retrieve({PreferenceType:"UserPreferenceStorage",Name:t}))).Value})}setItem(t,e){return Ie(this,null,function*(){return Promise.resolve(W.Update({PreferenceType:"UserPreferenceStorage",Name:t,Value:e}))})}};o(xe,"UserPreferenceStorage");var be=u(l(),1),Ce=u(l(),1);var Fe;(t=>{function n(e,r){e.on("dialogbeforeclose panelbeforeclose",function(i){!be.WX.hasOriginalEvent(i)||!r()||(i.preventDefault(),(0,Ce.confirmDialog)((0,Ce.localText)("Site.Dialogs.PendingChangesConfirmation"),()=>e.find("div.save-and-close-button").click(),{onNo:function(){e.hasClass("ui-dialog-content")?e.dialog("close"):e.hasClass("s-Panel")&&be.TemplatedDialog.closePanel(e)}}))})}t.pendingChangesConfirmation=n,o(n,"pendingChangesConfirmation")})(Fe||(Fe={}));var Te=u(l(),1),O=u(l(),1);var I=class extends Te.PropertyDialog{constructor(t){if(super(t),(0,O.isEmptyOrNull)(this.options.cssClass)||this.element.addClass(this.options.cssClass),!(0,O.isEmptyOrNull)(this.options.message)){var e=$("<div/>").addClass("message").insertBefore(this.byId("PropertyGrid"));this.options.isHtml?e.html(this.options.message):e.text(this.options.message)}this.dialogTitle=this.options.title||"Prompt"}getDialogButtons(){return[{text:(0,O.localText)("Dialogs.OkButton"),click:()=>{this.validateForm()&&(this.options.validateValue==null||this.options.validateValue(this.value))&&this.dialogClose()}},{text:(0,O.localText)("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}loadInitialEntity(){this.value=this.options.value}getPropertyItems(){return[{name:"Value",editorType:this.options.editorType||"String",required:(0,O.coalesce)(this.options.required,!0),editorParams:this.options.editorOptions}]}get value(){return this.getSaveEntity().Value}set value(t){this.propertyGrid.load({Value:t})}static prompt(t,e,r,i){new I({title:t,message:e,value:r,validateValue:a=>i(a)}).dialogOpen()}};o(I,"PromptDialog"),I=m([Te.Decorators.registerClass("Serenity.Extensions.PromptDialog")],I);var Se=u(l(),1);var ee=class extends Se.EntityGrid{getSlickOptions(){var t=super.getSlickOptions();return t.enableTextSelectionOnCells=!0,t.selectedCellCssClass="slick-row-selected",t.enableCellNavigation=!0,t}createSlickGrid(){var t=super.createSlickGrid();return t.setSelectionModel(new Slick.RowSelectionModel),t}};o(ee,"SelectableEntityGrid"),ee=m([Se.Decorators.registerClass("Serenity.Extensions.SelectableEntityGrid")],ee);var T=u(l(),1),k=u(l(),1);var te=class extends T.Select2AjaxEditor{constructor(e,r){super(e,r);this.setCascadeFrom(this.options.cascadeFrom)}setCascadeFrom(e){if((0,k.isEmptyOrNull)(e)){this.cascadeLink&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new T.CascadedWidgetLink(T.Widget,this,r=>this.cascadeValue=this.getCascadeFromValue(r)),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get cascadeValue(){return this.options.cascadeValue}set cascadeValue(e){e!==this.options.cascadeValue&&(this.options.cascadeValue=e,this.value=null)}get cascadeField(){return this.options.cascadeField||this.options.cascadeFrom}set cascadeField(e){this.options.cascadeField=e}get cascadeFrom(){return this.options.cascadeFrom}set cascadeFrom(e){e!==this.options.cascadeFrom&&this.setCascadeFrom(e)}getCascadeFromValue(e){return T.EditorUtils.getValue(e)}getIncludeColumns(){return[]}getSort(){return[]}getTypeDelay(){return 200}executeQueryByKey(e){var r=e.request;r.ColumnSelection=k.RetrieveColumnSelection.keyOnly,r.IncludeColumns=this.getIncludeColumns(),super.executeQueryByKey(e)}executeQuery(e){var r=e.request;r.ColumnSelection=k.ColumnSelection.KeyOnly,r.IncludeColumns=this.getIncludeColumns(),r.Sort=this.getSort(),r.ExcludeTotalCount=!0,this.cascadeField&&(r.EqualityFilter=r.EqualityFilter||{},r.EqualityFilter[this.cascadeField]=this.cascadeValue),e.blockUI=!1,e.error=()=>{},this.lastRequest!=null&&this.lastRequest.readyState!=XMLHttpRequest.DONE&&this.lastRequest.abort(),this.lastRequest=(0,k.serviceCall)(e),this.lastRequest.then(()=>this.lastRequest=null,()=>this.lastRequest=null)}};o(te,"ServiceEditorBase"),te=m([T.Decorators.registerClass("Serenity.Extensions.ServiceEditorBase")],te);var N=u(l(),1),de=u(l(),1);var re=class extends N.Widget{constructor(e,r){super(e,r);this.options.hideLabel&&this.element.closest(".field").find(".caption").hide(),this.updateElementContent()}updateElementContent(){var e=(0,de.coalesce)(this.options.text,this.value);this.options.isLocalText&&(e=(0,de.localText)(e)),this.options.isHtml?this.element.html(e):this.element.text(e)}setEditValue(e,r){this.options.text==null&&(this.value=(0,de.coalesce)(this.options.text,e[r.name]),this.updateElementContent())}};o(re,"StaticTextBlock"),re=m([N.Decorators.element("<div/>"),N.Decorators.registerEditor("Serenity.Extensions.StaticTextBlock",[N.ISetEditValue])],re);return Qe(Je);})();
Serenity.Extensions = Serenity.Extensions || {}; Object.assign(Serenity.Extensions, Serenity._); delete Serenity._;
//# sourceMappingURL=index.js.map
